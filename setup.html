<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlakeMonster CI — Setup</title>
  <link rel="icon" type="image/svg+xml" href="website/logo.svg">
  <link rel="stylesheet" href="website/styles.css">

  <script>
    (function() {
      var t = localStorage.getItem('theme');
      if (!t) t = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', t);
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-theme-toggle]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            var next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
          });
        });
      });
    })();
  </script>
</head>
<body>

  <!-- Top Nav -->
  <nav class="top-nav">
    <div class="top-nav-inner">
      <a href="index.html" class="nav-brand">FlakeMonster</a>
      <div class="nav-links">
        <a href="index.html#ci-section">CI</a>
        <a href="index.html#pricing-section">Pricing</a>
        <a href="docs/">Docs</a>
        <a href="https://github.com/growthboot/FlakeMonster">GitHub</a>
        <a href="account.html" class="nav-account-link">Account</a>
        <button class="theme-toggle" data-theme-toggle aria-label="Toggle dark mode"></button>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <section class="setup-page-header">
    <h1>Set Up the GitHub Action</h1>
    <p>Add FlakeMonster to your CI pipeline in under a minute.</p>
  </section>

  <!-- Setup card -->
  <section class="setup-section">
    <div class="setup-card">

      <!-- Tabs -->
      <div class="setup-tabs" id="setup-tabs">
        <button class="setup-tab active" data-setup="manual">Manual</button>
        <button class="setup-tab" data-setup="agent">Agent</button>
      </div>

      <!-- Tab: Agent -->
      <div class="setup-panel" data-setup-panel="agent">
        <p class="setup-agent-desc">Copy the prompt below and paste it into your AI coding agent (Claude Code, Cursor, Copilot, etc.). The agent will create the workflow file in the correct directory.</p>
        <div class="setup-agent-block">
          <pre class="setup-agent-prompt" id="agent-prompt">I want to add a FlakeMonster CI workflow to this project. Before creating any files, follow these steps:

1. First, look for all git repository roots by searching for .git directories (check the current directory and parent directories). Each repo root with a .git folder is a potential install location.

2. If no .git directory is found anywhere, stop and tell me: "No GitHub repository found. You need to initialize a git repo (git init) and push it to GitHub before adding this workflow."

3. If there are multiple repository roots (e.g. in a monorepo or nested repos), list all of them and ask me which one I want to install the workflow in. Wait for my answer before proceeding.

4. Once the install location is identified, create the file at &lt;repo-root&gt;/.github/workflows/flake-monster.yml with this content:

name: Flake Check
on: [pull_request]

jobs:
  flake-monster:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - uses: flake-monster/action@v1
        with:
          test-command: npm test

Make sure the .github/workflows/ directory exists. The id-token: write permission enables automatic usage tracking via GitHub OIDC. Ask me if I would like to update the test-command if this project uses a test runner like "npx jest", "npx vitest", "npx playwright test".</pre>
          <button class="setup-copy-btn" id="agent-copy-btn" title="Copy prompt">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="5" y="5" width="9" height="9" rx="1.5" stroke="currentColor" stroke-width="1.4"/><path d="M11 5V3.5A1.5 1.5 0 009.5 2h-6A1.5 1.5 0 002 3.5v6A1.5 1.5 0 003.5 11H5" stroke="currentColor" stroke-width="1.4"/></svg>
            <span>Copy</span>
          </button>
        </div>
      </div>

      <!-- Tab: Manual -->
      <div class="setup-panel active" data-setup-panel="manual">
        <p class="setup-result-desc">Add this file to your repository at <code>.github/workflows/flake-monster.yml</code>:</p>
        <div class="setup-result-code-wrap">
          <pre class="setup-result-code" id="manual-yaml">name: Flake Check
on: [pull_request]

jobs:
  flake-monster:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
      - run: npm ci
      - uses: flake-monster/action@v1
        with:
          test-command: npm test</pre>
          <button class="setup-copy-btn" id="yaml-copy-btn" title="Copy YAML">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="5" y="5" width="9" height="9" rx="1.5" stroke="currentColor" stroke-width="1.4"/><path d="M11 5V3.5A1.5 1.5 0 009.5 2h-6A1.5 1.5 0 002 3.5v6A1.5 1.5 0 003.5 11H5" stroke="currentColor" stroke-width="1.4"/></svg>
            <span>Copy</span>
          </button>
        </div>
        <div class="setup-result-note">
          <p>The <code>id-token: write</code> permission enables automatic usage tracking via GitHub OIDC — no API key needed.</p>
          <p>Update <code>test-command</code> if your project uses a different test runner (e.g. <code>npx jest</code>, <code>npx vitest</code>, <code>npx playwright test</code>).</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-inner" style="padding-top:32px">
      <div class="footer-bottom">
        <span>CLI licensed under MIT</span>
        <span class="footer-sep">&middot;</span>
        <a href="index.html" style="color:var(--accent);text-decoration:none">Back to FlakeMonster</a>
      </div>
    </div>
  </footer>

  <script>
    // ── Tab switching ──
    const tabs = document.getElementById('setup-tabs');
    const panels = document.querySelectorAll('.setup-panel');

    tabs.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-setup]');
      if (!btn) return;
      const id = btn.dataset.setup;

      tabs.querySelectorAll('.setup-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');

      panels.forEach(p => p.classList.remove('active'));
      document.querySelector(`[data-setup-panel="${id}"]`).classList.add('active');
    });

    // ── Copy buttons ──
    function setupCopyBtn(btnId, getContent) {
      const btn = document.getElementById(btnId);
      btn.addEventListener('click', () => {
        navigator.clipboard.writeText(getContent());
        const label = btn.querySelector('span');
        const original = label.textContent;
        label.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          label.textContent = original;
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    setupCopyBtn('agent-copy-btn', () => document.getElementById('agent-prompt').textContent);
    setupCopyBtn('yaml-copy-btn', () => document.getElementById('manual-yaml').textContent);
  </script>

</body>
</html>
