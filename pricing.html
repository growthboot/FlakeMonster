<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlakeMonster CI — Pricing</title>
  <link rel="icon" type="image/svg+xml" href="website/logo.svg">
  <link rel="stylesheet" href="website/styles.css">

  <script>
    (function() {
      var t = localStorage.getItem('theme');
      if (!t) t = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', t);
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-theme-toggle]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            var next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
          });
        });
      });
    })();
  </script>
</head>
<body>

  <!-- Top Nav -->
  <nav class="top-nav">
    <div class="top-nav-inner">
      <a href="index.html" class="nav-brand">FlakeMonster</a>
      <div class="nav-links">
        <a href="index.html#ci-section">CI</a>
        <a href="index.html#pricing-section">Pricing</a>
        <a href="https://github.com/growthboot/FlakeMonster">GitHub</a>
        <button class="theme-toggle" data-theme-toggle aria-label="Toggle dark mode"></button>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <section class="pricing-page-header">
    <h1>FlakeMonster CI Pricing</h1>
    <p>The free tier works automatically — no signup required. Just add the action to your workflow.</p>
  </section>

  <!-- Free tier info -->
  <section id="free" class="pricing-form-section">
    <div class="pricing-form-card">
      <div class="pricing-form-card-header">
        <h2>Free</h2>
        <p>50 checks per month, per repository. No account or configuration needed.</p>
      </div>
      <div class="pricing-setup-steps">
        <h3>Setup</h3>
        <ol>
          <li>Add the action to your workflow:
            <pre class="pricing-setup-code"><span class="syn-kw">permissions</span><span class="syn-pun">:</span>
  <span class="syn-kw">pull-requests</span><span class="syn-pun">:</span> <span class="syn-str">write</span>
  <span class="syn-kw">id-token</span><span class="syn-pun">:</span> <span class="syn-str">write</span>

<span class="syn-kw">steps</span><span class="syn-pun">:</span>
  <span class="syn-pun">-</span> <span class="syn-kw">uses</span><span class="syn-pun">:</span> <span class="syn-str">actions/checkout@v4</span>
  <span class="syn-pun">-</span> <span class="syn-kw">uses</span><span class="syn-pun">:</span> <span class="syn-str">actions/setup-node@v4</span>
  <span class="syn-pun">-</span> <span class="syn-kw">run</span><span class="syn-pun">:</span> <span class="syn-str">npm ci</span>
  <span class="syn-pun">-</span> <span class="syn-kw">uses</span><span class="syn-pun">:</span> <span class="syn-str">flake-monster/action@v1</span>
    <span class="syn-kw">with</span><span class="syn-pun">:</span>
      <span class="syn-kw">test-command</span><span class="syn-pun">:</span> <span class="syn-str">npm test</span></pre>
          </li>
          <li>That's it. The <code>id-token: write</code> permission enables automatic usage tracking via GitHub OIDC.</li>
        </ol>
      </div>
    </div>
  </section>

  <!-- Upgrade -->
  <section id="upgrade" class="pricing-form-section">
    <div class="pricing-form-card">
      <div class="pricing-form-card-header">
        <h2>Upgrade to Pro</h2>
        <p>Unlimited checks for $29/month. Enter your GitHub repository to upgrade.</p>
      </div>
      <form id="upgrade-form">
        <div class="pricing-form-row">
          <div class="pricing-form-field">
            <label for="up-owner">GitHub owner</label>
            <input type="text" id="up-owner" placeholder="user-or-org" required>
          </div>
          <div class="pricing-form-field">
            <label for="up-repo">Repository</label>
            <input type="text" id="up-repo" placeholder="repo-name" required>
          </div>
        </div>
        <button type="submit" class="pricing-btn pricing-btn-primary" id="up-btn">Continue to Checkout</button>
        <div class="pricing-form-error" id="up-error"></div>
      </form>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-inner" style="padding-top:32px">
      <div class="footer-bottom">
        <span>CLI licensed under MIT</span>
        <span class="footer-sep">&middot;</span>
        <a href="index.html" style="color:var(--accent);text-decoration:none">Back to FlakeMonster</a>
      </div>
    </div>
  </footer>

  <script>
    const CLOUD_API = 'https://flake-monster.web.app';

    // ── Upgrade ──
    const upForm = document.getElementById('upgrade-form');
    const upBtn = document.getElementById('up-btn');
    const upError = document.getElementById('up-error');

    upForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      upError.style.display = 'none';
      upBtn.disabled = true;
      upBtn.textContent = 'Redirecting...';

      try {
        const res = await fetch(`${CLOUD_API}/api/checkout`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            owner: document.getElementById('up-owner').value.trim(),
            repo: document.getElementById('up-repo').value.trim(),
          }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Checkout failed');

        window.location.href = data.url;
      } catch (err) {
        upError.textContent = err.message;
        upError.style.display = 'block';
        upBtn.disabled = false;
        upBtn.textContent = 'Continue to Checkout';
      }
    });

    // ── Post-Stripe redirect banners ──
    const params = new URLSearchParams(window.location.search);
    if (params.get('upgraded') === '1') {
      const b = document.createElement('div');
      b.className = 'pricing-banner pricing-banner-success';
      b.textContent = 'Upgrade successful! Your repository now has unlimited checks.';
      document.body.prepend(b);
    }
    if (params.get('cancelled') === '1') {
      const b = document.createElement('div');
      b.className = 'pricing-banner pricing-banner-error';
      b.textContent = 'Checkout cancelled. You can try again anytime.';
      document.body.prepend(b);
    }
  </script>

</body>
</html>
